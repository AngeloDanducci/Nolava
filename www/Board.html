<!DOCTYPE html>
<html>
<head lang="en">
   <meta charset="utf-8">
   <title>Nolava</title>
   <link rel="stylesheet" href="reset.css" />
   <link rel="stylesheet" href="nolava.css" />
   <link rel="stylesheet" href="https://code.jquery.com/ui/1.11.4/themes/ui-darkness/jquery-ui.css">
   <script src="https://code.jquery.com/jquery-2.2.1.min.js" integrity="sha256-gvQgAFzTH6trSrAWoH1iPo9Xc96QxSZ3feW6kem+O00=" crossorigin="anonymous"></script>
   <script src="https://code.jquery.com/ui/1.12.0-beta.1/jquery-ui.min.js" integrity="sha256-WyjlLy3rvVSitHOXMctYkMCOU6GAletPg+qniNKLCQM=" crossorigin="anonymous"></script>
   <script>
$(document).ready(function() {
  $("#name-modal").dialog({autoOpen:false, modal:true,show:"blind",hide:"blind"})
});

var wsocket = new WebSocket('ws://nolava.tk:1400', 'protocolOne');
//var wsocket = "";

document.onkeydown = function(event) {
  if (window.event)
    keycode = window.event.keyCode;
  else if (event)
    keycode = e.which;

  if (keycode == 13)
    send_msg();
}

wsocket.onopen = function(event) {
  //wsocket.send('Hello!');
}

wsocket.onmessage = function(event) {
  var msg = event.data;
  var time = new Date(msg.date);

  console.log(msg);

  var i = msg.indexOf(':')
  var action = [msg.slice(0,i), msg.slice(i+1)];

  if (action[0] == 'chat') {
    add_chat(action[1]);
  }
  else if (action[0] == 'request') {
    if (action[1] == 'name') {
      $('#name-modal').dialog('open');
    }
  }

}

function add_chat(message) {
  var newDiv = document.createElement('div');
  var newSpan = document.createElement('span');

  // Get user
  var i = message.indexOf(':')
  var user = msg.slice(0,i);
  var message = msg.slice(i+1);

  newSpan.innerHTML = user + ': ';
  // TODO: color code users?
  newDiv.appendChild(newSpan);
  newDiv.innerHTML = msg;
  document.getElementById('chat').appendChild(newDiv);
}

function send_name() {
  $('#name-modal').dialog('close');
  var name = document.getElementById('name-box').value;
  if (name.length > 0) {
    wsocket.send('name:' + name);
  }
}

function send_msg() {
  var msg = document.getElementById('chat-input').value;
    if (msg.length > 0) {
    console.log('Sending: ' + msg);
    try {
      wsocket.send('chat:'+msg);
      document.getElementById('chat-input').value = '';
    }
    catch (err) {}
  }
}

</script>
</head>
<body>

<div id="game">
  <div id="board">
    <img src="images/board5.png" alt="Game Board"/>
  </div>
  <div id="players">
    <div class="player">
      <button id="p1" type="button">Join Game</button>
    </div>
    <div class="player">
      <button id="p2"  type="button">Join Game</button>
    </div>
    <div class="player">
      <button id="p3" type="button">Join Game</button>
    </div>
    <div class="player">
      <button id="p4" type="button">Join Game</button>
    </div>
    <div class="player">
      <button id="p5" type="button">Join Game</button>
    </div>
    <div class="player">
      <button id="p6" type="button">Join Game</button>
    </div>
    <div class="player">
      <button id="p7" type="button">Join Game</button>
    </div>
    <div class="player">
      <button id="p8" type="button">Join Game</button>
    </div>
    <div class="player">
      <button id="p9" type="button">Join Game</button>
    </div>
    <div class="player">
      <button id="p10" type="button">Join Game</button>
    </div>
  </div>
  <div id="chat-wrapper">
    <div id="chat">
      <div>Welcome to Nolava!</div>
      <!--<div><span class="green">User: </span>Placeholder</div>-->
    </div>
    <input id='chat-input' type='text'>
  </div>
</div>
<p id="text">
  Blue Tint = Team Ruthra         Red Tint = Team Derdrom
</p>

</body>
</html>
